# BuildConfig Explanation

## What is BuildConfig?

`BuildConfig` is an **auto-generated class** created by the Android Gradle Plugin (AGP) during the build process. You don't need to write it manually - it's generated automatically based on your `build.gradle.kts` configuration.

## How BuildConfig Works

### 1. Configuration in build.gradle.kts

In `app/build.gradle.kts`, BuildConfig generation is enabled and configured:

```kotlin
android {
    namespace = "eu.kanade.tachiyomi"  // This determines the package name
    
    buildFeatures {
        buildConfig = true  // Enable BuildConfig generation
    }
    
    defaultConfig {
        applicationId = "app.komikku"
        versionCode = 77
        versionName = "1.13.5"
        
        // Custom BuildConfig fields
        buildConfigField("String", "COMMIT_COUNT", "\"${getCommitCount()}\"")
        buildConfigField("String", "COMMIT_SHA", "\"${getGitSha()}\"")
        buildConfigField("String", "BUILD_TIME", "\"${getBuildTime(useLastCommitTime = false)}\"")
        buildConfigField("boolean", "TELEMETRY_INCLUDED", "${Config.includeTelemetry}")
        buildConfigField("boolean", "UPDATER_ENABLED", "${Config.enableUpdater}")
    }
}
```

### 2. Generated BuildConfig Class

When you build the project, AGP automatically generates a class like this:

**Location**: `app/build/generated/source/buildConfig/<buildType>/eu/kanade/tachiyomi/BuildConfig.java`

**Generated Code** (example):
```java
package eu.kanade.tachiyomi;

public final class BuildConfig {
    // Auto-generated by AGP
    public static final boolean DEBUG = false;
    public static final String APPLICATION_ID = "app.komikku";
    public static final String BUILD_TYPE = "release";
    public static final String FLAVOR = "";
    public static final int VERSION_CODE = 77;
    public static final String VERSION_NAME = "1.13.5";
    
    // Custom fields from buildConfigField()
    public static final String COMMIT_COUNT = "1234";
    public static final String COMMIT_SHA = "abc123...";
    public static final String BUILD_TIME = "2024-01-01T12:00:00";
    public static final boolean TELEMETRY_INCLUDED = true;
    public static final boolean UPDATER_ENABLED = true;
}
```

### 3. Usage in Code

You can then use it in your Kotlin/Java code:

```kotlin
import eu.kanade.tachiyomi.BuildConfig

// Access auto-generated fields
val isDebug = BuildConfig.DEBUG
val appId = BuildConfig.APPLICATION_ID
val versionName = BuildConfig.VERSION_NAME

// Access custom fields
val commitCount = BuildConfig.COMMIT_COUNT
val commitSha = BuildConfig.COMMIT_SHA
val telemetryEnabled = BuildConfig.TELEMETRY_INCLUDED
```

## Why BuildConfig Might Not Exist

### Common Reasons:

1. **Project hasn't been built yet**
   - BuildConfig is generated during the build process
   - Solution: Build the project first

2. **IDE hasn't indexed generated files**
   - Sometimes IDEs don't immediately recognize generated code
   - Solution: Sync project and rebuild

3. **BuildConfig generation is disabled**
   - Check if `buildConfig = true` is set in `buildFeatures`
   - Solution: Ensure it's enabled (it is in this project)

4. **Wrong namespace/package**
   - BuildConfig is generated in the namespace package
   - Solution: Import from correct package: `eu.kanade.tachiyomi.BuildConfig`

5. **Build errors preventing generation**
   - If build fails, BuildConfig won't be generated
   - Solution: Fix build errors first

## How to Fix the Issue

### Step 1: Build the Project

```bash
# Clean and build
./gradlew clean build

# Or just build
./gradlew build

# Or sync in Android Studio
# File → Sync Project with Gradle Files
```

### Step 2: Verify BuildConfig Generation

After building, check if the file exists:
- Path: `app/build/generated/source/buildConfig/<buildType>/eu/kanade/tachiyomi/BuildConfig.java`
- Or: `app/build/generated/source/buildConfig/debug/eu/kanade/tachiyomi/BuildConfig.java`

### Step 3: Sync IDE

In Android Studio:
1. **File → Invalidate Caches / Restart**
2. **File → Sync Project with Gradle Files**
3. Rebuild the project

### Step 4: Check Import

Make sure you're importing from the correct package:

```kotlin
import eu.kanade.tachiyomi.BuildConfig  // ✅ Correct
// NOT: import android.BuildConfig  // ❌ Wrong
```

## BuildConfig Fields in This Project

Based on `app/build.gradle.kts`, the following custom fields are available:

| Field | Type | Description |
|-------|------|-------------|
| `COMMIT_COUNT` | String | Git commit count |
| `COMMIT_SHA` | String | Git commit SHA hash |
| `BUILD_TIME` | String | Build timestamp |
| `TELEMETRY_INCLUDED` | boolean | Whether telemetry is enabled |
| `UPDATER_ENABLED` | boolean | Whether updater is enabled |

Plus standard AGP fields:
- `DEBUG` - boolean
- `APPLICATION_ID` - String
- `BUILD_TYPE` - String
- `VERSION_CODE` - int
- `VERSION_NAME` - String

## Usage Examples in This Project

### MainActivity.kt
```kotlin
import eu.kanade.tachiyomi.BuildConfig

// Line 217: Check build type
val hasDebugOverlay = (isDebugBuildType || BuildConfig.BUILD_TYPE == "releaseTest")

// Line 410: Get commit count
val previewCurrentVersion = BuildConfig.COMMIT_COUNT.toInt()

// Line 438: Get version name
currentVersion = BuildConfig.VERSION_NAME
```

### App.kt
```kotlin
import eu.kanade.tachiyomi.BuildConfig

// Used for app initialization based on build config
```

### BuildConfig.kt (utility file)
```kotlin
package eu.kanade.tachiyomi.util.system

import eu.kanade.tachiyomi.BuildConfig

// Wrapper functions for easier access
val telemetryIncluded: Boolean
    inline get() = BuildConfig.TELEMETRY_INCLUDED

val updaterEnabled: Boolean
    inline get() = BuildConfig.UPDATER_ENABLED

val isDebugBuildType: Boolean
    inline get() = BuildConfig.BUILD_TYPE == "debug"
```

## Troubleshooting

### Error: "Unresolved reference: BuildConfig"

**Solution:**
1. Build the project: `./gradlew build`
2. Sync Gradle files in Android Studio
3. Invalidate caches and restart
4. Check that `buildConfig = true` in `buildFeatures`

### Error: "Cannot find BuildConfig in package eu.kanade.tachiyomi"

**Solution:**
1. Verify namespace in `build.gradle.kts`: `namespace = "eu.kanade.tachiyomi"`
2. Check import statement: `import eu.kanade.tachiyomi.BuildConfig`
3. Rebuild the project

### BuildConfig fields are null or wrong values

**Solution:**
1. Check `buildConfigField()` calls in `build.gradle.kts`
2. Ensure values are properly quoted for String types: `"\"value\""`
3. Rebuild after changing buildConfigField values

## Alternative: Manual BuildConfig (Not Recommended)

If you really need a manual BuildConfig (not recommended), you could create:

```kotlin
// app/src/main/java/eu/kanade/tachiyomi/BuildConfig.kt
package eu.kanade.tachiyomi

object BuildConfig {
    const val DEBUG = false
    const val APPLICATION_ID = "app.komikku"
    const val BUILD_TYPE = "release"
    const val VERSION_CODE = 77
    const val VERSION_NAME = "1.13.5"
    const val COMMIT_COUNT = "1234"
    const val COMMIT_SHA = "abc123"
    const val TELEMETRY_INCLUDED = true
    const val UPDATER_ENABLED = true
}
```

**But this is NOT recommended** because:
- You lose automatic generation
- Values won't update automatically
- You have to manually maintain it
- It conflicts with AGP's generated BuildConfig

## Summary

- **BuildConfig is auto-generated** by AGP during build
- **Location**: `app/build/generated/source/buildConfig/`
- **Package**: `eu.kanade.tachiyomi` (from namespace)
- **Enable**: `buildFeatures { buildConfig = true }`
- **Custom fields**: Added via `buildConfigField()` in `build.gradle.kts`
- **Fix**: Build the project first, then sync IDE

The BuildConfig class will be available after your first successful build!


